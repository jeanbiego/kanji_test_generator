# 問題抽出パターン拡張の実装

## 基本情報
- **タスク名**: 問題抽出パターン拡張
- **担当**: AI Assistant
- **開始日**: 2026-01-13
- **完了日**: 2026-01-13
- **優先度**: 中
- **影響度**: 中 - ユーザビリティの向上
- **関連Issue**: GitHub Issue #1

## 要件定義
### 機能概要
問題用紙作成ページの問題抽出パターンを2つから4つに拡張し、より柔軟な問題選択を可能にする。

### 詳細な要件
1. **既存機能の名称変更**
   - 「🎯 苦手漢字抽出」→「🎯 苦手上位」に変更
   - ロジックは変更なし（`incorrect_count`が高い順に抽出）

2. **新規機能の追加**
   - **苦手ランダム**: `incorrect_count >= 1`の問題からランダムに抽出
   - **最新**: `created_at`が新しい順に抽出

3. **既存機能の維持**
   - **ランダム**: 全問題からランダムに抽出（既存と同じ）

4. **UIレイアウトの変更**
   - 2列×2行の4ボタンレイアウトに変更

## 設計方針
### アーキテクチャ
- 既存の抽出ロジックを活用
- 新規抽出パターンの追加
- UIレイアウトの改善

### 実装方法
1. **UIレイアウトの変更**
   - `col1, col2, col3, col4`の4カラムを作成
   - 2列×2行のレイアウトに変更

2. **苦手上位ボタン（既存機能の名称変更）**
   - ボタン名とメッセージの変更のみ
   - ロジックは変更なし

3. **苦手ランダムボタン（新規機能）**
   - `incorrect_count >= 1`のフィルタリング
   - ランダム抽出処理

4. **最新ボタン（新規機能）**
   - `created_at`によるソート処理

5. **ランダムボタン（既存機能の維持）**
   - 既存のロジックをそのまま使用
   - col4に移動

## 実装計画
### Phase 1: UIレイアウトの変更
- [x] 4カラムの作成
- [x] 2列×2行のレイアウトに変更

### Phase 2: 既存機能の名称変更
- [x] 苦手漢字抽出を苦手上位に名称変更
- [x] 成功メッセージの変更

### Phase 3: 新規機能の実装
- [x] 苦手ランダム抽出機能の実装
- [x] 最新抽出機能の実装

### Phase 4: 既存機能の維持
- [x] ランダム抽出ボタンをcol4に移動

### Phase 5: エラーハンドリング
- [x] 各機能のエラーハンドリングを実装
- [x] 適切な警告メッセージの追加

## 技術的詳細
### 修正対象ファイル
- `src/app.py`: 問題用紙作成ページの抽出機能部分（約320-425行目）

### 新規実装機能
- 苦手ランダム抽出ロジック
- 最新抽出ロジック
- UIレイアウトの変更

### 使用技術
- Python 3.10+
- Streamlit
- randomモジュール（ファイル先頭にインポート追加）

## 実装内容
### 1. randomモジュールのインポート追加
- ファイル先頭に`import random`を追加

### 2. UIレイアウトの変更
- 2列×2行（4つのボタン）に変更
- `col1, col2, col3, col4`の4カラムを作成

### 3. 苦手上位ボタン（既存機能の名称変更）
- ボタン名: 「🎯 苦手漢字抽出」→「🎯 苦手上位」
- 成功メッセージ: 「苦手漢字をX問抽出しました」→「苦手上位をX問抽出しました」
- ロジック: 変更なし（`incorrect_count`が高い順に抽出）

### 4. 苦手ランダムボタン（新規機能）
- ボタン名: 「🎲 苦手ランダム」
- ロジック: `incorrect_count >= 1`の問題をフィルタリングし、ランダムに抽出
- エラーハンドリング: 苦手問題がない場合の警告を追加

### 5. 最新ボタン（新規機能）
- ボタン名: 「📅 最新」
- ロジック: `created_at`が新しい順に抽出

### 6. ランダムボタン（既存機能の維持）
- ボタン名: 「🎲 ランダム」（「🎲 ランダム抽出」から変更）
- ロジック: 変更なし（全問題からランダムに抽出）
- 配置: col4に移動

## エラーハンドリング
各機能に以下のエラーハンドリングを実装：
- 保存された問題がない場合: `st.warning("保存された問題がありません。問題登録ページで問題を作成してください。")`
- 苦手ランダムで苦手問題がない場合: `st.warning("苦手な問題が見つかりませんでした。")`
- 抽出失敗時: `st.error(f"❌ [機能名]抽出に失敗しました: {e}")`

## テスト計画
### 正常系テスト
- [x] 苦手上位: `incorrect_count`が高い順に正しく抽出されること
- [x] 苦手ランダム: `incorrect_count >= 1`の問題からランダムに抽出されること
- [x] 最新: `created_at`が新しい順に抽出されること
- [x] ランダム: 全問題からランダムに抽出されること（既存機能の動作確認）

### UIテスト
- [x] 4つのボタンが2列×2行で正しく配置されること
- [x] 各ボタンのクリックで適切な抽出が実行されること

### エラーハンドリングテスト
- [x] 各エラーケースで適切なメッセージが表示されること

## 動作確認結果
- ✅ 苦手上位抽出機能が動作する
- ✅ 苦手ランダム抽出機能が動作する
- ✅ 最新抽出機能が動作する
- ✅ ランダム抽出機能が動作する（既存機能の動作確認）
- ✅ UIが2列×2行で正しく表示される
- ✅ エラーハンドリングが適切に動作する
- ✅ 既存機能に影響がない

## 期待される効果
- **柔軟な問題選択**: 4つの抽出パターンにより、ユーザーのニーズに応じた問題選択が可能
- **ユーザビリティ向上**: 2列×2行のレイアウトで視認性と操作性が向上
- **機能拡張**: 既存の2パターンから4パターンに拡張し、より多様な学習ニーズに対応

## 実装完了サマリー
### 実装内容
1. **UIレイアウトの変更**: 2列×2行の4ボタンレイアウトに変更
2. **苦手上位ボタン**: 既存機能の名称変更（ロジックは変更なし）
3. **苦手ランダムボタン**: 新規機能の追加（`incorrect_count >= 1`の問題からランダム抽出）
4. **最新ボタン**: 新規機能の追加（`created_at`が新しい順に抽出）
5. **ランダムボタン**: 既存機能の維持（col4に移動）

### 動作確認結果
- ✅ 4つの抽出パターンが正しく動作する
- ✅ UIが2列×2行で正しく表示される
- ✅ エラーハンドリングが適切に動作する
- ✅ 既存機能に影響がない

### 実装完了日
**完了日**: 2026-01-13

---

**状態**: 実装完了、テスト完了
**最終更新日**: 2026-01-13
