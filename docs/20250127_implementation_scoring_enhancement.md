# 採点機能の拡張

## 基本情報
- **タスク名**: 採点機能の拡張
- **担当**: AI Assistant
- **開始日**: 2025-01-27
- **完了日**: 未定
- **優先度**: 高
- **影響度**: 高 - コア機能の拡張

## 要件定義
### 機能概要
採点ページで「今回印刷した問題群」をすべて自動的に表示し、採点できるようにする。採点後はCSVを更新できるように採点保存ボタンを追加する。

### 詳細な要件
1. **印刷した問題群の自動表示**
   - 印刷用ページで表示した問題群を採点ページで自動表示
   - セッション状態から印刷した問題を取得
   - 問題文、回答漢字、読みを表示

2. **採点機能**
   - 各問題に対して正解/不正解を入力可能
   - 採点結果をセッション状態に保存
   - 採点進捗の表示

3. **CSV更新機能**
   - 採点結果をCSVファイルに保存
   - 既存のAttemptStorageを拡張
   - 採点保存ボタンの実装

### 期待される動作
1. 印刷用ページで問題を表示後、採点ページに移動
2. 採点ページで印刷した問題群が自動表示される
3. 各問題に対して正解/不正解を入力
4. 採点完了後、採点保存ボタンでCSVを更新
5. 履歴管理ページで採点結果を確認可能

## 設計方針
### アーキテクチャ
- セッション状態ベースの印刷問題管理
- 既存のAttemptStorageの拡張
- 採点UIの実装

### 実装方法
1. **印刷問題の管理**
   - セッション状態に印刷した問題を保存
   - 採点ページで印刷問題を取得・表示

2. **採点UIの実装**
   - 問題一覧の表示
   - 正解/不正解の入力フォーム
   - 採点進捗の表示

3. **CSV更新機能**
   - AttemptStorageの拡張
   - 採点結果の保存
   - エラーハンドリング

## 実装計画
### Phase 1: 印刷問題の管理
- [ ] セッション状態に印刷問題を保存する機能
- [ ] 採点ページで印刷問題を取得する機能
- [ ] 印刷問題の表示機能

### Phase 2: 採点UIの実装
- [ ] 問題一覧の表示
- [ ] 正解/不正解の入力フォーム
- [ ] 採点進捗の表示
- [ ] 採点結果のセッション状態管理

### Phase 3: CSV更新機能
- [ ] AttemptStorageの拡張
- [ ] 採点結果の保存機能
- [ ] 採点保存ボタンの実装
- [ ] エラーハンドリング

## 技術的詳細
### 修正対象ファイル
- `src/app.py`: 採点ページの実装
- `src/modules/storage.py`: AttemptStorageの拡張
- `src/modules/models.py`: 採点結果のモデル（必要に応じて）

### 使用技術
- Streamlit `st.form`
- セッション状態管理
- CSV入出力
- Python 3.10+

## テスト計画
### 正常系テスト
- 印刷問題の自動表示
- 採点機能の動作
- CSV更新機能の動作

### 異常系テスト
- 印刷問題がない場合の処理
- CSV保存エラーの処理
- セッション状態の管理

## リスク評価
### 高リスク
- セッション状態の管理
- CSV更新の整合性

### 対策
- 段階的な実装
- 十分なテスト
- エラーハンドリングの実装

## 完了基準
- [ ] 印刷した問題群が採点ページで自動表示される
- [ ] 各問題に対して正解/不正解を入力できる
- [ ] 採点結果がCSVに保存される
- [ ] 採点保存ボタンが正常に動作する
- [ ] エラーハンドリングが適切に実装される

## 注意事項
- 既存の採点機能に影響を与えない
- セッション状態の適切な管理
- CSV更新の整合性を保つ

---

**状態**: 実装準備完了
**最終更新日**: 2025-01-27
