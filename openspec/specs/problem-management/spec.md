# 問題管理機能仕様

## 目的
漢字テストジェネレーターアプリケーションにおける問題の作成、編集、削除、管理の要件を定義します。

## Requirements

### Requirement: 問題の作成
システムは文、答えの漢字、読みを含む新しい問題をSHALL作成できる。

#### シナリオ: 有効な問題の作成
- WHEN ユーザーが文、答えの漢字、読みを入力する
- AND 文に答えの漢字が含まれている
- AND 読みがひらがなまたはカタカナである
- THEN システムは一意のIDを持つ新しい問題を作成する
- AND 問題がデータベースに保存される

#### シナリオ: 無効な問題の作成
- WHEN ユーザーが答えの漢字を含まない文を入力する
- OR 読みがひらがなまたはカタカナではない
- OR 必須フィールドが空である
- THEN システムは検証エラーを表示する
- AND 問題は作成されない

### Requirement: 問題の検証
システムは作成または更新前に問題データをSHALL検証する。

#### シナリオ: 答えの漢字の検証
- WHEN ユーザーが答えの漢字を入力する
- THEN システムは文に漢字が存在するかチェックする
- AND 漢字が見つからない場合はエラーを表示する

#### シナリオ: 読みの検証
- WHEN ユーザーが読みを入力する
- THEN システムはひらがなまたはカタカナ文字のみを含むことを検証する
- AND 保存用に読みをカタカナに正規化する

#### シナリオ: 重複問題の検出
- WHEN ユーザーが問題を作成する
- THEN システムは同じ文、答えの漢字、読みを持つ既存の問題をチェックする
- AND 重複が見つかった場合は警告を表示する
- AND ユーザーが続行またはキャンセルすることを許可する

### Requirement: 問題の編集
システムは既存の問題をSHALL編集できる。

#### シナリオ: 問題の更新
- WHEN ユーザーが編集のために既存の問題を選択する
- THEN システムは編集可能なフィールドに現在の問題データを表示する
- AND 問題作成と同じ検証ルールを適用する
- AND 検証が成功した場合は問題を更新する

#### シナリオ: 検証エラーがある問題の更新
- WHEN ユーザーが無効なデータで問題を更新しようとする
- THEN システムは検証エラーを表示する
- AND 問題は更新されない

### Requirement: 問題の削除
システムは問題をSHALL削除できる。

#### シナリオ: 単一問題の削除
- WHEN ユーザーが削除のために問題を選択する
- THEN システムは確認を求める
- AND 確認された場合は問題を削除する
- AND 関連するすべての試行記録を削除する

#### シナリオ: 複数問題の一括削除
- WHEN ユーザーが削除のために複数の問題を選択する
- THEN システムは確認を求める
- AND 確認された場合は選択されたすべての問題を削除する
- AND 関連するすべての試行記録を削除する

### Requirement: 問題の検索とフィルタリング
システムは問題の検索とフィルタリング機能をSHALL提供する。

#### シナリオ: テキスト検索
- WHEN ユーザーが検索語を入力する
- THEN システムは文、答えの漢字、読みフィールドを検索する
- AND 一致する問題を表示する

#### シナリオ: ソートオプション
- WHEN ユーザーがソートオプションを選択する
- THEN システムは作成日、文、または答えの漢字で問題をソートする
- AND ソートされた結果を表示する

#### シナリオ: 表示件数制御
- WHEN ユーザーが表示件数を設定する
- THEN システムは表示される問題数を制限する
- AND 必要に応じてページネーションを提供する

### Requirement: 問題データモデル
システムは特定のフィールドと制約を持つ問題データをSHALL維持する。

#### シナリオ: 問題データ構造
- WHEN 問題が作成される
- THEN 以下のフィールドを含む:
  - id: 一意の識別子（UUID）
  - sentence: 問題文（必須）
  - answer_kanji: 答えの漢字（必須）
  - reading: カタカナでの読み（必須）
  - created_at: 作成タイムスタンプ
  - incorrect_count: 不正解回数（デフォルト: 1）

#### シナリオ: データ永続化
- WHEN 問題が作成または更新される
- THEN データはCSV形式で保存される
- AND ファイルは自動的にバックアップされる
- AND データ整合性が維持される

### Requirement: 問題プレビュー
システムはテストで問題がどのように表示されるかのプレビューをSHALL提供する。

#### シナリオ: 問題プレビューの表示
- WHEN ユーザーが問題を作成または編集する
- THEN システムは以下のプレビューを表示する:
  - 答えの漢字が読みに置き換えられた文
  - 答えの漢字を入力すべき空白スペース
  - 期待される答えの形式

#### シナリオ: プレビューの正確性
- WHEN プレビューが表示される
- THEN 印刷されたテストで問題がどのように表示されるかを正確に表現する
- AND すべてのフォーマットとスペーシングが正しい

## 設計上の考慮事項
- システムは検証エラーに対して即座にフィードバックを提供すべき
- データ損失を防ぐため問題データは自動的に保存されるべき
- インターフェースは教師や教育者にとって直感的であるべき
- 検索とフィルタリングは高速で応答性があるべき
- システムは大量の問題を効率的に処理できるべき
