# 採点機能仕様

## 目的
漢字テストジェネレーターアプリケーションにおける漢字テストの採点と学生の成績記録の要件を定義します。

## Requirements

### Requirement: 採点インターフェース
システムは学生の答えとスコアを記録するためのインターフェースをSHALL提供する。

#### シナリオ: 採点用問題表示
- WHEN ユーザーが採点ページにアクセスする
- THEN システムは以下を表示する:
  - 最近作成されたテストのすべての問題
  - 漢字が読みに置き換えられた問題文
  - 期待される答え（漢字と読み）
  - 各問題の採点用入力フィールド

#### シナリオ: 採点入力
- WHEN ユーザーが問題を採点する
- THEN システムは以下のオプションを提供する:
  - 正解/不正解の選択
  - 間違いタイプの分類（不正解の場合）
  - 学習ノート（オプション）
  - タイムスタンプ記録

### Requirement: スコア記録
システムは採点データをSHALL記録・保存する。

#### シナリオ: 個別問題採点
- WHEN ユーザーが問題を採点する
- THEN システムは以下を記録する:
  - 問題ID
  - 正解/不正解ステータス
  - 間違いタイプ（不正解の場合）
  - 学習ノート
  - タイムスタンプ
  - 一意の試行ID

#### シナリオ: 一括採点
- WHEN ユーザーが複数の問題を採点する
- THEN システムは:
  - 各問題のスコアを個別に記録する
  - 問題とスコアの関係を維持する
  - 採点セッションの要約を提供する
  - すべてのスコアを一度に保存できる

### Requirement: 間違い分類
システムは異なるタイプの間違いの分類をSHALL提供する。

#### シナリオ: 間違いタイプ選択
- WHEN ユーザーが問題を不正解としてマークする
- THEN システムは以下のオプションを提供する:
  - 読み間違い（発音エラー）
  - 漢字間違い（文字エラー）
  - その他の間違い（一般的なエラー）
  - カスタム間違い説明

#### シナリオ: 間違い分析
- WHEN 間違いタイプが記録される
- THEN システムは:
  - 間違いタイプのパターンを追跡する
  - 将来の問題選択のための洞察を提供する
  - 改善領域の特定を支援する
  - 履歴間違いデータを維持する

### Requirement: 学習ノート
システムは各問題に学習ノートをSHALL追加できる。

#### シナリオ: ノート入力
- WHEN ユーザーが問題を採点する
- THEN システムは以下を提供する:
  - 学習ノート用のテキストフィールド
  - オプションのノート入力（必須ではない）
  - 試行記録と一緒のノート保存
  - 将来の参照用のノート取得

#### シナリオ: ノート管理
- WHEN 学習ノートが入力される
- THEN システムは:
  - 試行記録と一緒にノートを保存する
  - 履歴でノートを表示できる
  - ノートの検索機能を提供する
  - ノートの整合性を維持する

### Requirement: 自動採点
システムは自動採点機能をSHALL提供する。

#### シナリオ: 自動採点の有効化
- WHEN ユーザーが自動採点を有効にする
- THEN システムは:
  - 不正解回数に基づいて問題の難易度を分析する
  - 正解/不正解の可能性を提案する
  - 提案の信頼レベルを提供する
  - 自動スコアの手動上書きを許可する

#### シナリオ: 自動採点の精度
- WHEN 自動採点が使用される
- THEN システムは:
  - 履歴データを使用して精度を向上させる
  - 信頼レベルの明確な指標を提供する
  - 不正解な自動スコアの簡単な修正を許可する
  - ユーザーの修正から学習する

### Requirement: スコア検証
システムは保存前に採点データをSHALL検証する。

#### シナリオ: 必須フィールド検証
- WHEN ユーザーがスコアを保存しようとする
- THEN システムは以下を検証する:
  - すべての問題が採点されている
  - 必須フィールドが完了している
  - データ形式が正しい
  - 同じ問題の重複スコアがない

#### シナリオ: データ整合性検証
- WHEN スコアが保存される
- THEN システムは以下を確保する:
  - 問題IDが有効である
  - タイムスタンプが正確である
  - データ破損が発生しない
  - 保存前にバックアップが作成される

### Requirement: スコア履歴
システムはすべての採点試行の履歴をSHALL維持する。

#### シナリオ: 試行記録
- WHEN スコアが保存される
- THEN システムは:
  - 一意の試行記録を作成する
  - すべての問題スコアを試行にリンクする
  - 試行タイムスタンプを記録する
  - 試行メタデータを維持する

#### シナリオ: 履歴データアクセス
- WHEN ユーザーが採点履歴を表示する
- THEN システムは以下を提供する:
  - 試行の時系列リスト
  - 個別問題スコア
  - 間違いタイプ分析
  - 学習ノートレビュー

### Requirement: パフォーマンス分析
システムは学生のパフォーマンス分析をSHALL提供する。

#### シナリオ: パフォーマンス指標
- WHEN 採点データが利用可能である
- THEN システムは以下を計算する:
  - 全体的な精度率
  - 問題固有の難易度評価
  - 間違いタイプ頻度
  - 時間経過による改善傾向

#### シナリオ: 問題難易度調整
- WHEN パフォーマンスデータが分析される
- THEN システムは:
  - 問題難易度評価を更新する
  - 一貫して難しい問題を特定する
  - 復習用の問題を提案する
  - 改善パターンを追跡する

### Requirement: データエクスポート
システムは採点データのエクスポートをSHALL許可する。

#### シナリオ: CSVエクスポート
- WHEN ユーザーがデータエクスポートを要求する
- THEN システムは以下を提供する:
  - すべての採点データのCSV形式エクスポート
  - 個別試行記録
  - 問題パフォーマンス要約
  - 間違いタイプ分析

#### シナリオ: データ形式
- WHEN データがエクスポートされる
- THEN 以下を含む:
  - 分析に必要なすべてのフィールド
  - 適切なデータフォーマット
  - タイムスタンプ情報
  - 問題と試行の関係

## 設計上の考慮事項
- 採点インターフェースは教師にとって直感的であるべき
- データは損失を防ぐため自動的に保存されるべき
- システムは採点進捗について明確なフィードバックを提供すべき
- 分析は意味があり実行可能であるべき
- システムは大量の採点データを効率的に処理できるべき
